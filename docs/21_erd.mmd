```mermaid
erDiagram
    %% Lendgismo Entity Relationship Diagram
    %% Generated: October 16, 2025
    
    users ||--o{ loan_applications : "submits (borrower)"
    users ||--o{ loan_applications : "reviews (lender)"
    users ||--o{ bank_accounts : "owns"
    users ||--o{ application_invites : "receives (borrower)"
    users ||--o{ application_invites : "creates (lender)"
    users ||--|| account_settings : "has"
    users ||--o{ user_dashboard_config : "configures"
    
    loan_applications ||--o{ documents : "requires"
    loan_applications ||--o{ application_invites : "has"
    
    users {
        text id PK "UUID"
        text email UK "Unique, login credential"
        text password "Bcrypt hashed"
        text firstName "Required"
        text lastName "Required"
        text role "borrower | lender"
        text companyName "Nullable"
        text phone "Nullable"
        text createdAt "ISO 8601"
        text updatedAt "ISO 8601"
    }
    
    loan_applications {
        text id PK "UUID"
        text borrowerId FK "→ users.id"
        text businessName "Required"
        real loanAmount "USD amount"
        text loanPurpose "Free text"
        text collateralType "Asset category"
        real collateralValue "USD value"
        real annualRevenue "Nullable"
        integer timeInBusiness "Years, nullable"
        text status "pending | under_review | approved | rejected | funded"
        text submittedAt "ISO 8601"
        text reviewedAt "Nullable"
        text reviewedBy FK "→ users.id (lender)"
        integer aiScore "0-100, nullable"
        text notes "Internal lender notes"
        text createdAt "ISO 8601"
        text updatedAt "ISO 8601"
    }
    
    documents {
        text id PK "UUID"
        text applicationId FK "→ loan_applications.id"
        text fileName "Original filename"
        text fileType "MIME type"
        integer fileSize "Bytes"
        text documentType "business_license | financial_statements | etc"
        text status "uploaded | processing | approved | rejected"
        integer aiScore "0-100, nullable"
        text fileUrl "Storage URL"
        text uploadedAt "ISO 8601"
        text processedAt "Nullable"
    }
    
    bank_accounts {
        text id PK "UUID"
        text userId FK "→ users.id"
        text institutionName "Bank name"
        text accountName "Account nickname"
        text accountType "checking | savings | etc"
        real balance "USD, nullable"
        text plaidAccountId "Plaid identifier"
        text plaidAccessToken "Encrypted token"
        integer isConnected "Boolean (0|1)"
        text lastSyncedAt "ISO 8601"
        text createdAt "ISO 8601"
    }
    
    application_invites {
        text id PK "UUID"
        text applicationId FK "→ loan_applications.id"
        text borrowerId FK "→ users.id"
        text token UK "Crypto-random or HMAC"
        text email "Recipient email"
        text invitedBy FK "→ users.id (lender)"
        text usedAt "Nullable, one-time use"
        text expiresAt "ISO 8601"
        text createdAt "ISO 8601"
    }
    
    account_settings {
        text id PK "UUID"
        text userId FK UK "→ users.id (1:1)"
        text companyName "Nullable override"
        text logo "Custom logo URL"
        integer emailNotifications "Boolean, default true"
        integer smsNotifications "Boolean, default false"
        integer twoFactorEnabled "Boolean, default false"
        text defaultCurrency "ISO 4217, default USD"
        text timezone "IANA timezone"
        text language "ISO 639-1"
        real autoApproveThreshold "USD, nullable"
        text notificationPreferences "JSON string"
        text apiKey "Generated token"
        text webhookUrl "Callback URL"
        text createdAt "ISO 8601"
        text updatedAt "ISO 8601"
    }
    
    branding_settings {
        text id PK "UUID"
        text companyName "Platform name"
        text logoUrl "Logo image URL"
        text primaryColor "Hex #RRGGBB"
        text secondaryColor "Hex #RRGGBB"
        text accentColor "Hex #RRGGBB"
        text fontFamily "Font name"
        text loginBackgroundUrl "Background image"
        integer isActive "Boolean, default true"
        text createdAt "ISO 8601"
        text updatedAt "ISO 8601"
    }
    
    user_dashboard_config {
        text id PK "UUID"
        text userId FK "→ users.id"
        text layoutJson "JSON widget layout"
        text createdAt "ISO 8601"
        text updatedAt "ISO 8601"
    }
```

---

## Diagram Notes

### Cardinality Legend
- `||--||` : One-to-one (1:1)
- `||--o{` : One-to-many (1:N)
- `}o--o{` : Many-to-many (M:N) - not currently used

### Key Relationships

1. **Users as Borrowers** → Submit loan applications
2. **Users as Lenders** → Review and approve applications
3. **Loan Applications** → Have multiple supporting documents
4. **Loan Applications** → Can have multiple invites (regenerated if expired)
5. **Users** → Can connect multiple bank accounts (Plaid)
6. **Users** → Have exactly one account settings record (1:1)
7. **Users** → Can have custom dashboard configurations
8. **Branding Settings** → Standalone (global for now, future: per-tenant)

### Foreign Key Constraints

All foreign keys enforce referential integrity:
- Deleting a user requires cascading delete or orphan handling
- Deleting an application should cascade delete documents and invites
- Recommend soft deletes for audit trails

### Multi-Tenancy Considerations

**Current**: Single-tenant (global branding)  
**Future**: Add `tenantId` column to:
- `users`
- `loan_applications`
- `branding_settings` (one active per tenant)
- `account_settings`

This will enable row-level security and tenant isolation.

### Index Strategy

High-traffic queries:
- **Applications by status**: Index on `loan_applications.status`
- **Applications by borrower**: Index on `loan_applications.borrowerId`
- **Documents by application**: Index on `documents.applicationId`
- **Invites by token**: Unique index on `application_invites.token`
- **Bank accounts by user**: Index on `bank_accounts.userId`

See `20_data-model.md` for detailed index recommendations.

---

**Rendering**:
- Use Mermaid.js in Markdown viewers (GitHub, GitLab, Docusaurus)
- Or render to SVG/PNG via Mermaid CLI:
  ```bash
  npx @mermaid-js/mermaid-cli -i 21_erd.mmd -o 21_erd.svg
  ```
